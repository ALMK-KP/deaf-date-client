@if (store.tracks().length) {
  @if (store.mode() === "CREATION") {
    <div class="flex gap-2 justify-between items-center pt-8">
      <h2 class="text-lg font-semibold text-green-500 tracking-widest">
        Your current playlist
      </h2>
      <app-button
        icon="remove-48"
        (click)="openConfirmationDialog()"
      ></app-button>
    </div>
  }
  <ul
    cdkDropList
    class="pt-2 text-white text-sm gap-2 flex flex-col"
    [class.mt-8]="store.mode() !== 'CREATION'"
    (cdkDropListDropped)="drop($event)"
  >
    @for (track of store.tracks(); track track.id; let i = $index) {
      <li
        cdkDrag
        [cdkDragDisabled]="store.mode() !== 'CREATION'"
        class="p-2 bg-neutral-600 text-sm"
      >
        <div class="drag-custom-placeholder" *cdkDragPlaceholder></div>
        <div class="flex gap-2">
          @if (store.mode() === "CREATION") {
            <button
              cdkDragHandle
              class="shrink-0 text-center text-green-500 font-bold tracking-widest outline-none self-center -ml-1.5"
            >
              <img
                src="assets/icons/icons8-drag-reorder-24.png"
                width="16"
                height="16"
              />
            </button>
          }
          <p class="self-center">{{ i + 1 }}.</p>
          @if (track.thumbnail && store.mode() !== "ENCODED") {
            <a
              [href]="track.ytLink"
              target="_blank"
              class="block flex-shrink-0 self-start"
            >
              <img [src]="track.thumbnail" alt="" width="50" height="40" />
            </a>
          }
          <div class="w-full">
            @if (store.mode() !== "ENCODED") {
              <div class="flex justify-between items-start">
                <h3>{{ track.title }}</h3>
                <app-button
                  size="small"
                  class="ml-2"
                  [color]="store.mode() === 'DECODED' ? 'orange' : 'green'"
                  [icon]="
                    store.mode() === 'CREATION'
                      ? 'edit-24'
                      : store.mode() === 'DECODED'
                        ? 'play-24-orange'
                        : 'play-24'
                  "
                  [class.bg-neutral-700]="
                    expanded && expandedTrackId === track.id
                  "
                  (click)="toggleExpanded(track.id)"
                ></app-button>
              </div>
              <p>
                {{ track.channelTitle }}
              </p>
            }
            @if (track.customTitle || store.mode() === "ENCODED") {
              <div
                [class.italic]="store.mode() === 'DECODED'"
                [class.text-neutral-300]="store.mode() === 'DECODED'"
                [class.border-t]="store.mode() !== 'ENCODED'"
                [class.pt-2]="store.mode() !== 'ENCODED'"
                [class.mt-2]="store.mode() !== 'ENCODED'"
                [class.border-orange-500]="store.mode() === 'DECODED'"
                [class.border-green-500]="store.mode() !== 'DECODED'"
                class="text-xs flex justify-between items-center"
              >
                <p>{{ track.customTitle }}</p>
                @if (store.mode() === "ENCODED") {
                  <app-button
                    class="ml-2 justify-self-end"
                    size="small"
                    icon="play-24"
                    [class.bg-neutral-700]="
                      expanded && expandedTrackId === track.id
                    "
                    (click)="toggleExpanded(track.id)"
                  ></app-button>
                }
              </div>
            }
          </div>
        </div>
        @if (
          expanded &&
          track.id === expandedTrackId &&
          store.mode() === "CREATION"
        ) {
          <app-custom-description-input
            [initialValue]="track.customTitle"
            [trackId]="track.id"
            (customTitleUpdated)="updateCustomTitle($event)"
          />
        }

        @if (
          expanded &&
          track.id === expandedTrackId &&
          store.mode() !== "CREATION"
        ) {
          <audio
            controls
            class="mt-2 mx-auto"
            autoplay
            controlslist="nofullscreen nodownload noremoteplayback noplaybackrate"
          >
            <source [src]="track.audio" type="audio/mpeg" />
            Your browser does not support the audio element.
          </audio>
        }
      </li>
    }
  </ul>
} @else {
  @if (store.isLoading()) {
    <div class="grow flex items-center justify-center">
      <div class="grow justify-center flex">
        <div class="loader"></div>
      </div>
    </div>
  } @else if (store.mode() === "CREATION") {
    <p class="text-center italic pt-24 pb-20">No tracks added yet</p>
  } @else {
    <p class="text-center italic pt-24 pb-20">Playlist doesn't exist</p>
  }
}
<p
  class="text-center tracking-widest p-4"
  [class.text-orange-500]="store.mode() === 'DECODED'"
  [class.text-green-500]="store.mode() !== 'DECODED'"
>
  .. ... .. ...
</p>

@if (isConfirmationDialogOpened) {
  <app-dialog
    (emitDialogClicked)="removePlaylist($event)"
    message="Are you sure you want to delete current playlist?"
  />
}
