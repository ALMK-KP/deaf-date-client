@if (store.tracks().length) {
  @if (isMode(viewModeEnum.CREATION)) {
    <div class="flex gap-2 items-center pt-8">
      <h2 class="text-lg font-semibold text-green-500 tracking-wider">
        Your current playlist
      </h2>
      <button
        appearance="action-grayscale"
        iconStart="@tui.trash-2"
        size="s"
        tuiIconButton
        [style.border-radius.%]="100"
        (click)="openConfirmDialog()"
      ></button>
    </div>
  }

  <div cdkDropListGroup>
    <ul
      cdkDropList
      class="pt-2 text-white text-sm gap-2 flex flex-col"
      [cdkDropListData]="store.tracks()"
      [class.mt-8]="!isMode(viewModeEnum.CREATION)"
      (cdkDropListDropped)="drop($event)"
    >
      @for (track of store.tracks(); track track.id; let i = $index) {
        <li
          cdkDrag
          class="py-2 pl-2 rounded-lg text-sm"
          [cdkDragDisabled]="!isMode(viewModeEnum.CREATION)"
          (cdkDragStarted)="toggleDragging(true)"
        >
          <div class="drag-custom-placeholder" *cdkDragPlaceholder></div>
          <div class="flex gap-3">
            @if (isMode(viewModeEnum.CREATION)) {
              <button
                cdkDragHandle
                class="shrink-0 self-start h-[37.5px] text-center text-green-500 font-bold tracking-widest outline-none -ml-1.5"
              >
                <img
                  src="assets/icons/icons8-drag-reorder-24.png"
                  width="16"
                  height="16"
                />
              </button>
            }
            <div
              class="flex gap-3 w-full"
              (tuiHoveredChange)="onHovered($event, track)"
            >
              <div class="self-start h-[37.5px] flex items-center shrink-0 w-4">
                @if (
                  hoveredId === track.id &&
                  (!isPlaying ||
                    (isPlaying && selectedToPlayTrackId !== track.id))
                ) {
                  <tui-icon
                    icon="@tui.play-filled"
                    class="hover:cursor-pointer"
                    [style.height.px]="16"
                    [style.width.px]="16"
                    [class.text-green-500]="selectedToPlayTrackId === track.id"
                    (click)="selectTrack(track)"
                  />
                }
                @if (
                  hoveredId !== track.id &&
                  (selectedToPlayTrackId !== track.id ||
                    (selectedToPlayTrackId === track.id && !isPlaying))
                ) {
                  <p
                    [class.text-green-500]="selectedToPlayTrackId === track.id"
                  >
                    {{ i + 1 }}.
                  </p>
                }
                @if (selectedToPlayTrackId === track.id && isPlaying) {
                  <div class="track-playing"></div>
                }
              </div>
              @if (track.thumbnail && !isMode(viewModeEnum.ENCODED)) {
                <a
                  [href]="track.ytLink"
                  target="_blank"
                  class="block flex-shrink-0 self-start w-[40px] h-[40px] object-cover rounded-lg overflow-hidden"
                >
                  <div class="stretchy-wrapper">
                    <div>
                      <img [src]="track.thumbnail" />
                    </div>
                  </div>
                </a>
              }
              <div class="max-w-[364px] grow">
                @if (!isMode(viewModeEnum.ENCODED)) {
                  <div class="flex justify-between items-start">
                    <h3
                      tuiFade
                      class="text-nowrap"
                      [class.text-green-500]="
                        selectedToPlayTrackId === track.id
                      "
                    >
                      {{ track.title }}
                    </h3>
                    <button
                      appearance="action-grayscale"
                      iconStart="@tui.ellipsis-vertical"
                      size="xs"
                      tuiIconButton
                      [style.border-radius.%]="100"
                      (click)="openTrackContextMenuDialog(track)"
                    ></button>
                  </div>
                }

                <p
                  tuiFade
                  class="text-xs text-nowrap text-neutral-400 max-w-[332px]"
                >
                  {{ track.customTitle }}
                </p>
              </div>
            </div>
          </div>
        </li>
      }
    </ul>
  </div>
} @else {
  @if (store.isLoading()) {
    <div class="grow flex items-center justify-center">
      <div class="grow justify-center flex">
        <div class="loader"></div>
      </div>
    </div>
  } @else if (isMode(viewModeEnum.CREATION)) {
    <p class="text-center italic pt-24 pb-20">No tracks added yet</p>
  } @else {
    <p class="text-center italic pt-24 pb-20">Playlist doesn't exist</p>
  }
}
<p
  class="text-center tracking-widest p-4"
  [class.text-orange-500]="isMode(viewModeEnum.DECODED)"
  [class.text-green-500]="!isMode(viewModeEnum.DECODED)"
>
  .. ... .. ...
</p>

@if (selectedToPlayTrackId) {
  <app-player
    [trackId]="selectedToPlayTrackId"
    [trackSrc]="selectedTrackSrc"
    (pause)="handleOnPause($event)"
    (play)="handleOnPlay($event)"
  />
}

<app-track-context-menu-dialog />
