@if (store.tracks().length) {
  @if (store.mode() === "CREATION") {
    <div class="flex gap-2 justify-between items-center pt-8">
      <h2 class="text-lg font-semibold text-green-500 tracking-widest">
        Your current playlist
      </h2>
      <button
        class="my-1 mx-2 text-center font-bold text-green-500 tracking-widest ring-2 ring-green-500 outline-none focus:ring-4 focus:ring-green-500 hover:ring-4 hover:ring-green-500 p-1"
        (click)="openConfirmationDialog()"
      >
        <img src="assets/icons/icons8-remove-48.png" width="24" height="24" />
      </button>
    </div>
  }
  <ul
    class="pt-2 text-white text-sm gap-2 flex flex-col"
    [class.mt-8]="store.mode() !== 'CREATION'"
  >
    @for (track of store.tracks(); track track.id; let i = $index) {
      <li class="rounded-sm p-2 bg-neutral-600">
        <div class="flex gap-2">
          <p>{{ i + 1 }}.</p>
          @if (track.thumbnail && store.mode() !== "ENCODED") {
            <a
              [href]="track.ytLink"
              target="_blank"
              class="block flex-shrink-0"
            >
              <img [src]="track.thumbnail" alt="" width="50" height="40" />
            </a>
          }
          <div class="w-full">
            @if (store.mode() !== "ENCODED") {
              <div class="flex justify-between items-start">
                <h3>{{ track.title }}</h3>
                <button
                  class="shrink-0 mb-1 ml-4 mr-1 text-center font-bold tracking-widest ring-2 outline-none focus:ring-4 hover:ring-4 p-1"
                  [class.ring-green-500]="store.mode() !== 'DECODED'"
                  [class.ring-orange-500]="store.mode() === 'DECODED'"
                  [class.text-green-500]="store.mode() !== 'DECODED'"
                  [class.text-orange-500]="store.mode() === 'DECODED'"
                  [class.focus:ring-green-500]="store.mode() !== 'DECODED'"
                  [class.focus:ring-orange-500]="store.mode() === 'DECODED'"
                  [class.hover:ring-green-500]="store.mode() !== 'DECODED'"
                  [class.hover:ring-orange-500]="store.mode() === 'DECODED'"
                  [class.bg-neutral-700]="
                    expanded && expandedTrackId === track.id
                  "
                  (click)="toggleExpanded(track.id)"
                >
                  <img
                    [src]="
                      store.mode() === 'CREATION'
                        ? 'assets/icons/icons8-edit-24.png'
                        : store.mode() === 'DECODED'
                          ? 'assets/icons/icons8-play-24-orange.png'
                          : 'assets/icons/icons8-play-24.png'
                    "
                    width="12"
                    height="12"
                  />
                </button>
              </div>
              <p>
                {{ track.channelTitle }}
              </p>
            }
            @if (track.customTitle || store.mode() === 'ENCODED') {
              <p
                [class.italic]="store.mode() === 'DECODED'"
                [class.text-neutral-300]="store.mode() === 'DECODED'"
                [class.border-t]="store.mode() !== 'ENCODED'"
                [class.pt-2]="store.mode() !== 'ENCODED'"
                [class.mt-2]="store.mode() !== 'ENCODED'"
                [class.border-orange-500]="store.mode() === 'DECODED'"
                [class.border-green-500]="store.mode() !== 'DECODED'"
                class="text-xs flex justify-between items-center"
              >
                {{ track.customTitle }}
                @if (store.mode() === "ENCODED") {
                  <button
                    class="shrink-0 ml-auto mr-1 text-center font-bold text-green-500 ring-green-500 focus:ring-green-500 hover:ring-green-500 tracking-widest ring-2 outline-none focus:ring-4 hover:ring-4 p-1"
                    [class.bg-neutral-700]="
                      expanded && expandedTrackId === track.id
                    "
                    (click)="toggleExpanded(track.id)"
                  >
                    <img
                      src="assets/icons/icons8-play-24.png"
                      width="12"
                      height="12"
                    />
                  </button>
                }
              </p>
            }
          </div>
        </div>
        @if (
          expanded &&
          track.id === expandedTrackId &&
          store.mode() === "CREATION"
        ) {
          <app-custom-description-input
            [initialValue]="getInitialValueOfCustomTitle(track.customTitle)"
            [trackId]="track.id"
            (customTitleUpdated)="updateCustomTitle($event)"
          />
        }

        @if (
          expanded &&
          track.id === expandedTrackId &&
          store.mode() !== "CREATION"
        ) {
          <audio
            controls
            class="mt-2 mx-auto"
            autoplay
            controlslist="nofullscreen nodownload noremoteplayback noplaybackrate"
          >
            <source [src]="track.audio" type="audio/mpeg" />
            Your browser does not support the audio element.
          </audio>
        }
      </li>
    }
  </ul>
} @else {
  @if (store.isLoading()) {
    <div class="grow flex items-center justify-center">
      <div class="grow justify-center flex">
        <div class="loader"></div>
      </div>
    </div>
  } @else if (store.mode() === "CREATION") {
    <p class="text-center italic pt-24 pb-20">No tracks added yet</p>
  } @else {
    <p class="text-center italic pt-24 pb-20">Playlist doesn't exist</p>
  }
}
<p
  class="text-center tracking-widest p-4"
  [class.text-orange-500]="store.mode() === 'DECODED'"
  [class.text-green-500]="store.mode() !== 'DECODED'"
>
  .. ... .. ...
</p>
@if (isConfirmationDialogOpened) {
  <app-dialog
    (emitDialogClicked)="removePlaylist($event)"
    message="Are you sure you want to delete current playlist?"
  />
}
